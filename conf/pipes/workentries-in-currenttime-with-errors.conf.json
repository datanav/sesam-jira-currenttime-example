{
  "_id": "workentries-in-currenttime-with-errors",
  "source": {
    "type": "dataset",
    "dataset": "workentry-currenttime-with-jira-keys-step8-has-errors-filter"
  },
  "transform": {
    "type": "dtl",
    "rules": {
      "default": [

        ["copy", "_id"],

        ["comment", "This dataset represents the final output of all the other pipes",
          "so we do a bit of cleanup and annotation here."
        ],

        ["add", "Username", "_S.user_name"],
        ["add", "Date", "_S.date"],


        ["comment", "Rename and tweak some attributes to make them more end-user readable."],
        ["add", "Errors", ["replace", "\n", " ", ["replace", "\r", " ", ["join", ". ", "_S.errors"]]]],
        ["add", "JIRA keys",  ["replace", "\n", " ", ["replace", "\r", " ", ["join", ", ", "_S.jira_issue_keys"]]]],

        ["comment",
          "Change attribute names to something more humanreadable and ",
          "switch from '.' to ',' as decimal separator, since Excel prefers it"],
        ["add", "JIRA hours", ["replace", ".", ",", ["string", "_S.total_jira_timeworked"]]],
        ["add", "CT hours", ["replace", ".", ",", ["string", "_S.timeworked"]]],


        ["add", "CT note",  ["replace", "\n", " ", ["replace", "\r", " ", "_S.note"]]],

        ["comment",
          "Add info about currenttime subtask, task and project."],
        ["add", "temp_currenttime_subtask",
          ["first",
            ["hops", {
              "datasets": ["cooked-currenttime-subtask currenttime_subtask"],
              "where":
                ["eq", ["string", "_S.currenttime_subtask_id"], "currenttime_subtask._id"]
              }
            ]]],

        ["add", "CT subtask", "_T.temp_currenttime_subtask.subtaskname"],
        ["add", "CT task", "_T.temp_currenttime_subtask.taskname"],
        ["add", "CT project", "_T.temp_currenttime_subtask.projectname"],
        ["add", "CT projecttype", "_T.temp_currenttime_subtask.projecttypename"],

        ["remove", "temp_*"]

      ]
    }
  },
  "pump": {
    "schedule_interval": 10
  },
  "type": "pipe"
}
