{
  "_id": "workentries-in-currenttime-with-errors",
  "source": {
    "type": "dataset",
    "dataset": "workentry-currenttime-with-jira-keys-step8-has-errors-filter"
  },
  "transform": {
    "type": "dtl",
    "rules": {
      "default": [

        ["copy", "_id"],

        ["comment", "This dataset represents the final output of all the other pipes",
          "so we do a bit of cleanup and annotation here."
        ],

        ["add", "user_name", "_S.user_name"],
        ["add", "date", "_S.date"],


        ["comment", "Rename and tweak some attributes to make them more end-user readable."],
        ["add", "errors", ["replace", "\n", " ", ["replace", "\r", " ", ["join", "\\. ", "_S.errors"]]]],
        ["add", "jira_issue_keys_from_currentime_note",  ["replace", "\n", " ", ["replace", "\r", " ", ["join", ", ", "_S.jira_issue_keys"]]]],
        ["rename", "timeworked", "timeworked_from_currenttime"],
        ["rename", "total_jira_timeworked", "timeworked_from_jira"],
        ["add", "note_from_currenttime",  ["replace", "\n", " ", ["replace", "\r", " ", "_S.note"]]],

        ["comment",
          "Add info about currenttime subtask, task and project."],
        ["add", "temp_currenttime_subtask",
          ["first",
            ["hops", {
              "datasets": ["cooked-currenttime-subtask currenttime_subtask"],
              "where":
                ["eq", ["string", "_S.currenttime_subtask_id"], "currenttime_subtask._id"]
              }
            ]]],

        ["add", "currenttime_subtask", "_T.temp_currenttime_subtask.subtaskname"],
        ["add", "currenttime_task", "_T.temp_currenttime_subtask.taskname"],
        ["add", "currenttime_project", "_T.temp_currenttime_subtask.projectname"],
        ["add", "currenttime_projecttype", "_T.temp_currenttime_subtask.projecttypename"],

        ["remove", "temp_*"]

      ]
    }
  },
  "pump": {
    "schedule_interval": 1
  },
  "type": "pipe"
}
