{
  "_id": "workentry-jira-step1-cook-jira-worklog",
  "source": {
    "type": "dataset",
    "dataset": "jira-worklog"
  },
  "transform": {
    "type": "dtl",
    "rules": {
      "default": [
        ["copy", "_id"],

        ["comment", "Convert to hours."],
        ["add", "timeworked", ["/", ["decimal", "_S.timeworked"], 3600]],

        ["comment",
          "Cast from Decimal to float and back to get rid of trailing zeros after the decimal point.",
          "This is a bit of a hack and should be fixed."
          ],
        ["add", "timeworked", ["decimal", ["float", "_T.timeworked"]]],

        ["comment", "In the 'jira-worklog' dataset the issueid is a float, for some reason"],
        ["add", "issueid", ["string", "_S.issueid"]],

        ["add", "date", ["datetime-format", "%Y-%m-%d", "_S.STARTDATE"]],

        ["add", "user_name", "_S.AUTHOR"],

        ["comment", "Look up the jira issue key and store it."],
        ["add", "temp_cooked_jira_jiraissue",
          ["hops", {
            "datasets": ["cooked-jira-jiraissue cooked_jira_jiraissue"],
            "where":
              ["eq", ["string", "_S.issueid"], "cooked_jira_jiraissue._id"]
            }
          ]
        ],
        ["add", "jira_issue_key", ["first", "_T.temp_cooked_jira_jiraissue.jira_issue_key"]],

        ["comment",
          "Create the id of the 'jira-workentry' entity that this entity will eventually ",
          "contribute to."
        ],
        ["add", "workentry_id", ["concat", ["list", "_T.user_name", "--", "_T.date", "--", "_T.jira_issue_key"]]],

        ["comment", "Remove the temporary variables."],
        ["remove", "temp_*"]
      ]
    }
  },
  "pump": {
    "schedule_interval": 10
  },
  "type": "pipe"
}
